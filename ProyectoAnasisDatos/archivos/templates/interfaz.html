<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Interfaz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { display: flex; height: 100vh; margin: 0; }
        .menu { width: 250px; background-color: #f8f9fa; padding: 20px; border-right: 1px solid #dee2e6; }
        .menu h4 { margin-bottom: 20px; }
        .menu button { margin-bottom: 10px; width: 100%; }
        .contenido { flex-grow: 1; padding: 20px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="menu">
        <h4>Menú</h4>
        <button class="btn btn-success btn-cargar" data-url="{% url 'listar_archivos' %}">Gestión de datos</button>
        <button id="btn-analisis" class="btn btn-outline-success btn-cargar" disabled>Análisis descriptivo</button>
        <button id="btn-procesar" class="btn btn-outline-success btn-cargar" disabled>Procesamiento</button>
        <button id="btn-modelar" class="btn btn-outline-success btn-cargar" disabled>Modelado</button>
    </div>

    <div class="contenido" id="contenido">
        <div class="alert alert-info text-center">
            <h4>Bienvenido al sistema de análisis</h4>
            <p>Por favor, comienza seleccionando una opción del menú.</p>
        </div>
    </div>

    <script>
        // Función para cargar vistas vía AJAX
        function cargarVista(button) {
            let url = button.getAttribute("data-url");

            // Añadir ID si es necesario
            const id = localStorage.getItem("archivoSeleccionado");
            if (button.id === "btn-analisis") {
                if (!id) return alert("Debes seleccionar un archivo primero.");
                url = `/ver/${id}/`;
            } else if (button.id === "btn-procesar") {
                if (!id) return alert("Debes seleccionar un archivo primero.");
                url = `/ver/${id}/`;  // Ajusta si tienes otra URL
            } else if (button.id === "btn-modelar") {
                if (!id) return alert("Debes seleccionar un archivo primero.");
                url = `/grafica/${id}/`;
            }

            fetch(url)
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    document.getElementById("contenido").innerHTML = doc.body.innerHTML;
                })
                .catch(error => {
                    console.error("Error al cargar:", error);
                    document.getElementById("contenido").innerHTML = `
                        <div class="alert alert-danger">Error al cargar el contenido.</div>
                    `;
                });
        }

        // Asignar eventos a botones
        document.querySelectorAll(".btn-cargar").forEach(button => {
            button.addEventListener("click", () => cargarVista(button));
        });

        // Delegación para botón "Seleccionar" que se carga dinámicamente
        document.addEventListener("click", function (e) {
            if (e.target.classList.contains("seleccionar-archivo")) {
                e.preventDefault();
                const archivoId = e.target.dataset.id;
                localStorage.setItem("archivoSeleccionado", archivoId);

                // Activar botones
                document.getElementById("btn-analisis").disabled = false;
                document.getElementById("btn-procesar").disabled = false;
                document.getElementById("btn-modelar").disabled = false;

                alert("Archivo seleccionado con ID: " + archivoId);
            }
        });

        // Al cargar la página, verificar si hay un archivo ya seleccionado
        window.addEventListener("load", () => {
            const id = localStorage.getItem("archivoSeleccionado");
            if (id) {
                document.getElementById("btn-analisis").disabled = false;
                document.getElementById("btn-procesar").disabled = false;
                document.getElementById("btn-modelar").disabled = false;
            }
        });
    </script>
</body>
</html>
